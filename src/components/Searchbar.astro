---
import { getCollection } from "astro:content";
import Search from "./Search";
import { RESUME } from "../data/resume";

// Get Blog Posts
const blogPosts = (await getCollection("blog"))
  .filter((post) => post.data.draft === false);

// Transform Blog Posts to SearchItems
const blogItems = blogPosts.map(post => ({
    title: post.data.title,
    description: post.data.description,
    url: `/blog/${post.slug}/`,
    type: "blog" as const,
    date: post.data.pubDate.valueOf(),
    originalData: post
}));

// Get Projects
const { projects } = RESUME;

// Transform Projects to SearchItems
const projectItems = projects.map(project => ({
    title: project.title,
    description: project.description,
    url: `/projects/${project.slug}`, // Link to individual page
    type: "project" as const,
    date: project.date ? parseInt(project.date) : 0 // Basic date handling
}));

// Combine and Sort
const searchList = [...blogItems, ...projectItems].sort((a, b) => {
    // Prioritize items with dates (newest first), then projects
    // Note: blog dates are timestamps (large numbers), project dates are years (small numbers) or 0
    // This sorting might need refinement if strict chronological order between blogs and projects is needed.
    // For now, let's just default sort.
    return b.date - a.date;
});
---

<Search client:load searchList={searchList} />
