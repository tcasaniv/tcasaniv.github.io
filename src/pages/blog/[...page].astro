---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { type CollectionEntry, getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import PostList from "../../components/PostList.astro";
import { PAGINATION_POSTS_PER_PAGE } from "../../consts";

export const prerender = true;

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const posts = (await getCollection("blog"))
    .filter((post) => post.data.draft === false)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(posts, {
    pageSize: PAGINATION_POSTS_PER_PAGE,
  });
};

export type Props = {
  page: Page<CollectionEntry<"blog">>;
};

const { page } = Astro.props;
---

<BaseLayout
  title="Blog | Terry Casani"
  description="Entradas interesantes sobre ingeniería y relacionados."
>
  <div class="container-custom py-8">
    <div class="main-content">
      <h1 class="section-title text-3xl font-bold mb-6">Blog</h1>
      <p class="mb-6 text-[var(--text-muted)]">
        Buscar entradas del blog por <a href="/categories" class="text-link">categoría</a>.
      </p>

      <div class="grid gap-8">
        <PostList posts={page.data} />
        
        <div class="flex justify-between mt-8 border-t border-[var(--border-color)] pt-4">
          {
            page.url.prev ? (
              <a class="text-link flex items-center gap-2" href={page.url.prev}>
                &larr; Anterior
              </a>
            ) : (
              <span />
            )
          }
          {
            page.url.current ? (
              <span class="text-[var(--text-muted)]">Página {page.currentPage}</span>
            ) : (
              <span />
            )
          }
          {
            page.url.next ? (
              <a
                class="text-link flex items-center gap-2"
                href={page.url.next}
              >
                Siguiente &rarr;
              </a>
            ) : (
              <span />
            )
          }
        </div>
      </div>
    </div>
  </div>
</BaseLayout>